<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSearch AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; 
        }
        .chat-bubble {
            max-width: 85%; /* Increased width for artifact bubbles */
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .chat-bubble-user {
            background-color: #3b82f6; 
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .chat-bubble-ai {
            background-color: #e5e7eb; 
            color: #1f2937; 
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        .chat-bubble-ai.personal-assistant { 
            background-color: #ede9fe; 
            color: #5b21b6; 
        }
        .chat-bubble-ai.personal-assistant .font-semibold {
             color: #6d28d9; 
        }
        .chat-bubble-system {
            background-color: #f9fafb; 
            color: #6b7280; 
            font-size: 0.875rem;
            text-align: center;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
        }
        .sidebar-item:hover {
            background-color: #e5e7eb;
        }
        .active-item { 
            background-color: #d1d5db; 
            font-weight: 600;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c4c4c4;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .news-item-clickable { 
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            padding: 8px;
            border-radius: 8px;
            margin-top: 4px; 
        }
        .news-item-clickable:hover {
            background-color: rgba(0,0,0,0.05);
        }
        .news-detail-card { 
            border: 1px solid #d1d5db; 
            border-radius: 8px;
            padding: 12px;
            background-color: #f9fafb; 
            margin-top: 8px;
        }
        .news-category-button {
            transition: background-color 0.2s, color 0.2s;
        }
        .news-category-button.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
        }
        .news-list-item {
            border-bottom: 1px solid #e5e7eb;
        }
        .news-list-item:last-child {
            border-bottom: none;
        }
        .document-item { /* For right panel lists */
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .document-item:hover {
            background-color: #e0e7ff; /* Light indigo for hover */
        }
        .document-item i {
            margin-right: 8px;
            color: #6b7280;
        }
        .chat-content-scroll {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 0; 
        }
        .ai-artifact-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }
        .ai-artifact-card h4 {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="flex h-screen antialiased text-gray-800">
    <!-- Left Sidebar -->
    <aside class="flex flex-col w-72 bg-gray-100 border-r border-gray-200 p-4 space-y-6 shrink-0">
        <div class="flex items-center space-x-3 px-2">
            <i class="fas fa-brain fa-2x text-blue-600"></i>
            <h1 class="text-2xl font-bold text-gray-800">DeepSearch AI</h1>
        </div>
        <div class="p-3 bg-white rounded-lg shadow">
            <div class="flex items-center space-x-3">
                <img src="https://placehold.co/40x40/E2E8F0/333?text=김" alt="사용자 프로필 사진" class="w-10 h-10 rounded-full">
                <div>
                    <p class="font-semibold text-gray-700">김팀장</p>
                    <p class="text-xs text-gray-500">전략기획팀 / 팀장</p>
                </div>
            </div>
            <button class="mt-3 w-full text-sm bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md transition duration-150">
                <i class="fas fa-sign-out-alt mr-1"></i> 로그아웃
            </button>
        </div>
        <div>
            <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">개인 메뉴</h2>
            <nav>
                 <a href="#personal-assistant" onclick="showPersonalAssistant(event)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item active-item">
                    <i class="fas fa-user-astronaut w-5 h-5 text-purple-500"></i>
                    <span>개인 어시스턴트</span>
                </a>
            </nav>
        </div>
        <div>
            <div class="flex justify-between items-center mb-1 mt-3">
                <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide">워크스페이스</h2>
                <button class="text-blue-500 hover:text-blue-700 text-sm" title="새 워크스페이스 만들기" onclick="alert('새 워크스페이스 만들기 기능은 목업입니다.')">
                    <i class="fas fa-plus-circle"></i> 새로 만들기
                </button>
            </div>
            <nav class="space-y-1">
                <a href="#ws-market-research" onclick="showGeneralizedWorkspaceView(event, '시장 조사: 스마트홈 경쟁 분석', 'market_research', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-search-dollar w-5 h-5 text-cyan-500"></i>
                    <span>시장 조사: 스마트홈</span>
                </a>
                <a href="#ws-new-business" onclick="showGeneralizedWorkspaceView(event, '신규 사업: AI 코칭 서비스', 'new_business', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-lightbulb w-5 h-5 text-amber-500"></i>
                    <span>신규 사업: AI 코칭</span>
                </a>
                <a href="#ws-mna-beta" onclick="showGeneralizedWorkspaceView(event, 'M&A: 베타 솔루션 인수', 'mna_dataroom', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-handshake w-5 h-5 text-red-500"></i>
                    <span>M&A: 베타 솔루션</span>
                    <span class="ml-auto inline-block px-2 py-0.5 text-xs font-semibold bg-red-100 text-red-600 rounded-full">Hot</span>
                </a>
                <a href="#ws-proposal-bigcorp" onclick="showGeneralizedWorkspaceView(event, '고객 제안: 빅테크 Corp', 'customer_proposal', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-file-signature w-5 h-5 text-blue-500"></i>
                    <span>제안: 빅테크 Corp</span>
                </a>
                <a href="#ws-meeting-q3" onclick="showGeneralizedWorkspaceView(event, '회의: 3분기 전략 워크샵', 'meeting_management', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-users w-5 h-5 text-lime-500"></i>
                    <span>회의: 3분기 전략 워크샵</span>
                </a>
                <a href="#ws-report-marketing" onclick="showGeneralizedWorkspaceView(event, '보고서: 월간 마케팅 성과', 'reporting', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-chart-line w-5 h-5 text-green-500"></i>
                    <span>보고서: 마케팅 성과</span>
                </a>
                 <a href="#ws-legal-privacy" onclick="showGeneralizedWorkspaceView(event, '법률 검토: 개인정보보호법', 'legal_review', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-gavel w-5 h-5 text-gray-500"></i>
                    <span>법률 검토: 개인정보보호</span>
                </a>
                <a href="#ws-investment-esg" onclick="showGeneralizedWorkspaceView(event, '투자 포트폴리오: 글로벌 ESG', 'investment_portfolio', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-chart-pie w-5 h-5 text-teal-500"></i>
                    <span>투자: 글로벌 ESG 펀드</span>
                </a>
            </nav>
        </div>
        <div>
            <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 mt-3">데이터베이스</h2>
            <div class="space-y-1">
                <a href="#news-feed" onclick="showNewsFeedView(event)" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-globe w-5 h-5 text-gray-500"></i><span>뉴스 피드</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>공시</span></a>
                 <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>특허</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>리서치</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-database w-5 h-5 text-indigo-500"></i><span>기업 정보</span><i class="fas fa-lock text-xs text-gray-400 ml-auto" title="유료 구독 필요"></i></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-dollar-sign w-5 h-5 text-teal-500"></i><span>투자 정보</span><i class="fas fa-lock text-xs text-gray-400 ml-auto" title="유료 구독 필요"></i></a>
            </div>
        </div>
        <div class="mt-auto p-2 text-center"><p class="text-xs text-gray-500">&copy; 2025 딥서치 AI</p></div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col bg-white overflow-hidden">
        <div id="mainContentArea" class="flex-1 flex flex-col overflow-hidden"> 
            <!-- Personal Assistant View -->
            <div id="personalAssistantView" class="hidden flex-1 flex-col overflow-hidden"> 
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0"> 
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-user-astronaut text-purple-500 mr-2"></i> 개인 어시스턴트
                        </h2>
                        <button class="text-gray-500 hover:text-gray-700" title="어시스턴트 설정">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                </header>
                <div id="personalChatArea" class="chat-content-scroll p-6 space-y-4"></div>
                <div class="bg-gray-50 p-4 border-t border-gray-200 shrink-0"> 
                    <div class="flex items-center space-x-3">
                        <button class="text-gray-500 hover:text-gray-700" title="파일 첨부"><i class="fas fa-paperclip fa-lg"></i></button>
                        <input type="text" id="personalChatInput" placeholder="AI 비서에게 메시지를 보내거나 작업을 요청하세요..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition duration-150">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-150" title="전송" onclick="sendPersonalChatMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- Generalized Workspace View (Chat-centric) -->
            <div id="generalizedWorkspaceView" class="hidden flex-1 flex-col overflow-hidden">
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0">
                    <div class="flex items-center justify-between">
                        <h2 id="generalizedWorkspaceTitle" class="text-xl font-semibold text-gray-800 flex items-center">
                            <i id="generalizedWorkspaceIcon" class="fas fa-briefcase mr-2"></i> 
                            <span>일반 워크스페이스</span>
                        </h2>
                        <div class="flex items-center space-x-3">
                             <button class="text-gray-500 hover:text-gray-700" title="워크스페이스 설정"><i class="fas fa-cog fa-lg"></i></button>
                             <div id="generalizedWorkspaceMembers" class="flex -space-x-2 overflow-hidden">
                                <!-- Members will be loaded by JS -->
                            </div>
                        </div>
                    </div>
                </header>

                <div class="flex-1 flex min-h-0"> <!-- Main content area with chat and right panel -->
                    <!-- Central Chat Area -->
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <div id="mainWorkspaceChatArea" class="chat-content-scroll p-6 space-y-4">
                            <!-- Chat messages will be appended here by JS -->
                        </div>
                        <div class="bg-gray-50 p-4 border-t border-gray-200 shrink-0">
                            <div class="flex items-center space-x-3">
                                <button class="text-gray-500 hover:text-gray-700" title="파일 첨부">
                                    <i class="fas fa-paperclip fa-lg"></i>
                                </button>
                                <input type="text" id="mainWorkspaceChatInput" placeholder="AI에게 요청하거나 팀원과 대화하세요..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition duration-150">
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-150" onclick="sendMainWorkspaceChatMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Contextual Panel -->
                    <aside class="w-96 bg-gray-50 border-l border-gray-200 p-4 flex flex-col space-y-4 overflow-y-auto shrink-0">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 flex items-center">
                                <i class="fas fa-folder-open mr-2 text-yellow-500"></i> 관련 자료
                                <button class="ml-auto text-xs text-blue-500 hover:text-blue-700" onclick="aiSuggestMaterial()">AI 자료 제안</button>
                            </h3>
                            <div id="relatedMaterialsList" class="space-y-1 text-sm max-h-60 overflow-y-auto bg-white p-2 rounded-md border">
                                 <p class="text-xs text-gray-400 p-2">관련 자료가 여기에 표시됩니다.</p>
                            </div>
                            <button class="mt-2 w-full text-xs text-gray-600 hover:text-gray-800 py-1.5 px-2 rounded-md border border-gray-300 hover:bg-gray-100">
                                <i class="fas fa-plus-circle mr-1"></i> 자료 추가/업로드
                            </button>
                        </div>
                        <hr>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 flex items-center">
                                <i class="fas fa-cogs mr-2 text-indigo-500"></i> AI 작업 로그 & 산출물
                            </h3>
                            <div id="aiArtifactsList" class="space-y-1 text-sm max-h-60 overflow-y-auto bg-white p-2 rounded-md border">
                                 <p class="text-xs text-gray-400 p-2">AI 작업 결과가 여기에 기록됩니다.</p>
                            </div>
                        </div>
                        <hr>
                        <div id="aiSuggestionsSectionInWorkspace">
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2"><i class="fas fa-lightbulb text-yellow-400 mr-1"></i> AI 제안</h3>
                            <div id="suggestionListInWorkspace" class="space-y-2 text-sm">
                                 <p class="text-xs text-gray-500">AI 제안이 여기에 표시됩니다.</p>
                            </div>
                        </div>
                         <hr>
                        <div id="workspaceTeamMembersSection">
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">팀 멤버</h3>
                            <div id="workspaceTeamMembersListRight" class="space-y-2 text-sm">
                                <!-- Team members list for the current workspace -->
                            </div>
                        </div>
                    </aside>
                </div>
            </div>


            <!-- News Feed View (remains the same as previous version) -->
            <div id="newsFeedView" class="hidden flex-1 flex-col overflow-hidden">
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center"><i class="fas fa-newspaper text-orange-500 mr-2"></i> 뉴스 피드</h2>
                        <div class="flex items-center space-x-2">
                            <input type="text" placeholder="뉴스 검색..." class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            <button class="text-gray-500 hover:text-orange-600" title="필터"><i class="fas fa-filter"></i></button>
                        </div>
                    </div>
                </header>
                <div class="p-4 shrink-0 border-b border-gray-200">
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        <button onclick="showNewsCategory('my-feed', this)" class="news-category-button active px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">내 피드</button>
                        <button onclick="showNewsCategory('top-issues', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">오늘의 주요 이슈</button>
                        <button onclick="showNewsCategory('politics', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">정치</button>
                        <button onclick="showNewsCategory('economy', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">경제</button>
                         <button onclick="showNewsCategory('society', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">사회</button>
                        <button onclick="showNewsCategory('it-science', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">IT/과학</button>
                        <button onclick="showNewsCategory('world', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">국제</button>
                    </div>
                </div>
                <div id="newsListArea" class="chat-content-scroll p-6"></div>
            </div>
        </div>
    </main>

    <!-- Right Sidebar (This is now part of the generalized workspace for its contextual content) -->
    <!-- The global right sidebar is removed as its content is now integrated into the right panel of generalizedWorkspaceView -->

    <script>
        // --- DOM Elements ---
        const personalAssistantView = document.getElementById('personalAssistantView');
        const generalizedWorkspaceView = document.getElementById('generalizedWorkspaceView');
        const newsFeedView = document.getElementById('newsFeedView'); 
        
        const generalizedWorkspaceTitleElement = document.getElementById('generalizedWorkspaceTitle').querySelector('span');
        const generalizedWorkspaceIconElement = document.getElementById('generalizedWorkspaceIcon');
        const generalizedWorkspaceMembersElement = document.getElementById('generalizedWorkspaceMembers'); // For header
        const workspaceTeamMembersListRightElement = document.getElementById('workspaceTeamMembersListRight'); // For right panel

        const personalChatArea = document.getElementById('personalChatArea');
        const mainWorkspaceChatArea = document.getElementById('mainWorkspaceChatArea'); // Central chat for generalized workspace
        const newsListArea = document.getElementById('newsListArea'); 
        
        const relatedMaterialsList = document.getElementById('relatedMaterialsList');
        const aiArtifactsList = document.getElementById('aiArtifactsList');
        const suggestionListInWorkspace = document.getElementById('suggestionListInWorkspace'); // Renamed

        const sidebarLinks = document.querySelectorAll('.sidebar-item');
        
        // Removed global attachedFilesSection, fileList, aiSuggestionsSection, suggestionList as they are now part of the right panel of generalizedWorkspaceView
        
        let currentWorkspaceType = null; 
        let currentWorkspaceName = '';
        let backtestingChartInstance = null; // Keep this for potential charts in AI artifacts

        // --- Utility Functions ---
        function hideAllMainViews() {
            personalAssistantView.classList.add('hidden');
            personalAssistantView.classList.remove('flex', 'flex-col');
            generalizedWorkspaceView.classList.add('hidden');
            generalizedWorkspaceView.classList.remove('flex', 'flex-col');
            newsFeedView.classList.add('hidden');
            newsFeedView.classList.remove('flex', 'flex-col');
        }

        function setActiveLink(selectedLink) {
            sidebarLinks.forEach(link => link.classList.remove('active-item'));
            if (selectedLink) selectedLink.classList.add('active-item');
        }

        function addChatMessage(chatAreaElement, sender, message, isUser, isPersonalAssistant = false, artifact = null) {
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble');
            if (isUser) {
                bubble.classList.add('chat-bubble-user');
            } else {
                bubble.classList.add('chat-bubble-ai');
                if (isPersonalAssistant) {
                    bubble.classList.add('personal-assistant');
                }
            }

            let senderHtml = `<p class="font-semibold text-sm mb-0.5">${sender}</p>`;
            if (!isUser) {
                let iconClass = 'fas fa-robot text-indigo-500'; // Default for workspace AI
                if (isPersonalAssistant) iconClass = 'fas fa-user-astronaut text-purple-500';
                senderHtml = `<p class="font-semibold text-sm mb-0.5"><i class="${iconClass} mr-1"></i> ${sender}</p>`;
            }
            
            let messageHtml = `<p>${message}</p>`;
            if (artifact) {
                messageHtml += `
                    <div class="ai-artifact-card">
                        <h4><i class="fas ${artifact.icon || 'fa-file-alt'} mr-2 text-gray-500"></i>${artifact.title}</h4>
                        <p class="text-xs text-gray-600">${artifact.summary}</p>
                        ${artifact.action ? `<button class="text-xs mt-2 bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded" onclick="${artifact.action.func}('${artifact.action.param}')">${artifact.action.label}</button>` : ''}
                    </div>`;
            }

            bubble.innerHTML = senderHtml + messageHtml;
            chatAreaElement.appendChild(bubble);
            chatAreaElement.scrollTop = chatAreaElement.scrollHeight;
        }
        
        // --- Personal Assistant Functions ---
        function initializePersonalAssistantChat() {
            personalChatArea.innerHTML = ''; 
            addChatMessage(personalChatArea, '개인 AI 비서', '반갑습니다, 김팀장님! 오늘 업무를 시작해 볼까요? <i class="fas fa-rocket text-purple-400"></i>', false, true);
            addChatMessage(personalChatArea, '개인 AI 비서', '오늘 김팀장님이 챙겨볼 만한 주요 뉴스입니다. 클릭하시면 상세 내용을 보실 수 있습니다:', false, true, {
                title: '뉴스 아티클 (예시)',
                summary: '글로벌 AI 시장, 연평균 30% 성장 전망. ABC 뉴스 - 1시간 전. 최신 보고서에 따르면...',
                icon: 'fa-newspaper',
                action: { label: '자세히 보기', func: 'alert', param: '뉴스 상세 보기 목업' }
            });
        }

        function showPersonalAssistant(event) {
            if(event) event.preventDefault();
            hideAllMainViews();
            personalAssistantView.classList.remove('hidden');
            personalAssistantView.classList.add('flex', 'flex-col'); 
            setActiveLink(document.querySelector('a[href="#personal-assistant"]'));
            initializePersonalAssistantChat(); 
            // Right panel for personal assistant (simplified or different content)
            relatedMaterialsList.innerHTML = `<p class="text-xs text-gray-400 p-2">개인 작업 관련 파일 또는 노트를 여기에 표시합니다.</p>`;
            aiArtifactsList.innerHTML = `<p class="text-xs text-gray-400 p-2">최근 개인 AI 작업 로그가 여기에 표시됩니다.</p>`;
            workspaceTeamMembersListRightElement.innerHTML = `<p class="text-xs text-gray-500">개인 어시스턴트 사용 중입니다.</p>`;
            suggestionListInWorkspace.innerHTML = `
                <div class="p-3 bg-purple-50 border border-purple-200 rounded-md">
                    <p class="font-medium text-purple-700">💡 오늘의 할 일 제안:</p>
                    <p class="text-purple-600 text-xs">"오후 2시 빅테크 Corp 제안 준비 상태 점검."</p>
                    <button class="text-xs mt-1 text-purple-500 hover:underline" onclick="showGeneralizedWorkspaceView(null, '고객 제안: 빅테크 Corp', 'customer_proposal', document.querySelector('a[href=\\'#ws-proposal-bigcorp\\']'))">관련 워크스페이스 가기</button>
                </div>`;
        }
        
        function sendPersonalChatMessage() {
            const inputElement = document.getElementById('personalChatInput');
            const messageText = inputElement.value.trim();
            if (messageText === "") return;
            addChatMessage(personalChatArea, '김팀장 (나)', messageText, true, true);
            inputElement.value = ""; 
            setTimeout(() => {
                addChatMessage(personalChatArea, '개인 AI 비서', `알겠습니다, 김팀장님. 요청하신 "<span class="font-medium">${messageText}</span>"에 대해 처리 중입니다. (목업 응답)`, false, true, {
                    title: '요청 처리 결과 (예시)',
                    summary: '관련 정보를 검색하여 요약했습니다. 확인하시겠습니까?',
                    icon: 'fa-check-circle',
                    action: { label: '결과 보기', func: 'alert', param: 'AI 요청 처리 결과 목업' }
                });
            }, 1000);
        }
        
        // --- News Feed Functions (remains mostly the same) ---
        function showNewsFeedView(event) {
             if(event) event.preventDefault();
            hideAllMainViews();
            newsFeedView.classList.remove('hidden');
            newsFeedView.classList.add('flex', 'flex-col');
            setActiveLink(document.querySelector('a[href="#news-feed"]'));
            showNewsCategory('my-feed', document.querySelector('#newsFeedView .news-category-button')); 
            // Right panel content for news feed
            relatedMaterialsList.innerHTML = `<p class="text-xs text-gray-400 p-2">스크랩한 뉴스나 관련 메모를 여기에 표시합니다.</p>`;
            aiArtifactsList.innerHTML = `<p class="text-xs text-gray-400 p-2">뉴스 요약 AI 작업 로그.</p>`;
            workspaceTeamMembersListRightElement.innerHTML = `<p class="text-xs text-gray-500">뉴스 피드 보기 중입니다.</p>`;
            suggestionListInWorkspace.innerHTML = `<div class="p-3 bg-orange-50 border border-orange-200 rounded-md"><p class="font-medium text-orange-700">📰 뉴스 필터링 팁:</p><p class="text-orange-600 text-xs">"키워드 검색이나 필터 기능을 사용하여 원하는 뉴스를 빠르게 찾아보세요."</p></div>`;
        }

        function showNewsCategory(category, buttonElement) {
            const buttons = document.querySelectorAll('#newsFeedView .news-category-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            if(buttonElement) buttonElement.classList.add('active');
            newsListArea.innerHTML = ''; 
            let articlesHtml = `<h3 class="text-lg font-semibold text-gray-700 mb-4">"${getCategoryDisplayName(category)}" 관련 뉴스</h3>`;
            const mockNews = {
                'my-feed': [{ title: "내 피드 맞춤형 뉴스 1: AI가 추천하는 오늘의 주요 기술 동향", source: "TechCrunch", time: "30분 전", summary: "생성형 AI 모델의 새로운 발전과 산업 적용 사례 심층 분석...", link: "#" }],
                'top-issues': [{ title: "오늘의 주요 이슈 1: 글로벌 공급망 위기, 반도체 산업 영향은?", source: "Reuters", time: "2시간 전", summary: "지정학적 긴장과 물류 대란이 반도체 수급에 미치는 영향 분석...", link: "#" }],
                'politics': [{ title: "정치 뉴스 1: 여야, 주요 법안 처리 두고 대립", source: "연합뉴스", time: "1시간 전", summary: "국회 본회의를 앞두고 주요 쟁점 법안에 대한 여야 간 입장 차이 여전...", link: "#"}]
            };
            const articles = mockNews[category] || [{ title: "선택하신 카테고리에 대한 뉴스가 없습니다.", source: "", time: "", summary: "", link: "#"}];
             articles.forEach(article => {
                articlesHtml += `<div class="news-list-item py-4"><a href="${article.link}" target="_blank" class="hover:text-indigo-600"><h4 class="text-md font-semibold text-gray-800">${article.title}</h4></a><div class="text-xs text-gray-500 mt-1"><span>${article.source}</span>${article.source && article.time ? '<span class="mx-1">|</span>' : ''}<span>${article.time}</span></div><p class="text-sm text-gray-600 mt-2">${article.summary}</p><div class="mt-2"><button class="text-xs text-indigo-500 hover:underline">자세히 보기</button><button class="text-xs text-gray-500 hover:underline ml-2">관련 워크스페이스에 공유</button></div></div>`;
            });
            newsListArea.innerHTML = articlesHtml;
            newsListArea.scrollTop = 0; 
        }

        function getCategoryDisplayName(categoryKey) {
            const names = {'my-feed': '내 피드', 'top-issues': '오늘의 주요 이슈', 'politics': '정치', 'economy': '경제', 'society': '사회', 'it-science': 'IT/과학', 'world': '국제'};
            return names[categoryKey] || categoryKey;
        }

        // --- Generalized Workspace Functions (NEW CHAT-CENTRIC UI) ---
        function showGeneralizedWorkspaceView(event, workspaceNameFromLink, type, linkElement) {
            if(event) event.preventDefault();
            hideAllMainViews();
            generalizedWorkspaceView.classList.remove('hidden');
            generalizedWorkspaceView.classList.add('flex', 'flex-col');
            
            currentWorkspaceType = type; 
            currentWorkspaceName = workspaceNameFromLink;
            generalizedWorkspaceTitleElement.textContent = currentWorkspaceName;
            setActiveLink(linkElement || (event ? event.currentTarget : null));

            const iconClasses = {
                'market_research': 'fa-search-dollar text-cyan-500', 'new_business': 'fa-lightbulb text-amber-500',
                'mna_dataroom': 'fa-handshake text-red-500', 'customer_proposal': 'fa-file-signature text-blue-500',
                'meeting_management': 'fa-users text-lime-500', 'reporting': 'fa-chart-line text-green-500',
                'legal_review': 'fa-gavel text-gray-500', 'investment_portfolio': 'fa-chart-pie text-teal-500',
                'default': 'fa-briefcase text-gray-700'
            };
            generalizedWorkspaceIconElement.className = `fas ${iconClasses[type] || iconClasses['default']} mr-2`;

            // Mock members in header
            generalizedWorkspaceMembersElement.innerHTML = `
                <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white" src="https://placehold.co/32x32/E2E8F0/333?text=김" alt="김팀장">
                <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white" src="https://placehold.co/32x32/A7F3D0/1C64F2?text=이" alt="이애널리스트">
                <a class="flex items-center justify-center h-8 w-8 rounded-full ring-2 ring-white bg-gray-200 text-xs font-medium text-gray-600 hover:bg-gray-300" href="#">+${Math.floor(Math.random() * 3) + 1}</a>`;
            
            // Initialize main chat area for the workspace
            mainWorkspaceChatArea.innerHTML = '';
            let initialAiMessage = `안녕하세요, 김팀장님. "${currentWorkspaceName}" 워크스페이스입니다. 무엇을 도와드릴까요?`;
            if (type === 'market_research') {
                initialAiMessage = `"${currentWorkspaceName}" 워크스페이스에 오신 것을 환영합니다. 스마트홈 시장의 경쟁사 분석, 시장 동향 파악 등 AI에게 요청해보세요. 예를 들어, "최근 3개월간 스마트홈 보안 기술 관련 뉴스 요약해줘" 와 같이 질문할 수 있습니다.`;
            } else if (type === 'investment_portfolio') {
                 initialAiMessage = `"${currentWorkspaceName}" 워크스페이스입니다. AI와 함께 글로벌 ESG 투자 전략을 수립하고 백테스팅을 진행해 보세요. "유망 ESG 기업 리스트 분석해줘" 또는 "특정 ESG 테마의 과거 수익률 알려줘" 등으로 시작할 수 있습니다.`;
            }
            addChatMessage(mainWorkspaceChatArea, '워크스페이스 AI', initialAiMessage, false);

            // Initialize right panel content
            loadRelatedMaterials(type);
            loadAiArtifacts(type);
            loadAiSuggestionsForWorkspace(type); // Re-using this function, target div is suggestionListInWorkspace
            loadWorkspaceTeamMembersRight(type);
        }

        function loadRelatedMaterials(workspaceType) {
            relatedMaterialsList.innerHTML = ''; // Clear previous
            let itemsHtml = '';
            if (workspaceType === 'market_research') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-pdf"></i> 스마트홈 시장 보고서_2024.pdf</div>
                    <div class="document-item"><i class="fas fa-link"></i> 경쟁사 A 홈페이지</div>
                    <div class="document-item"><i class="fas fa-table"></i> 소비자 설문조사 Raw Data.xlsx</div>`;
            } else if (workspaceType === 'investment_portfolio') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-alt"></i> ESG 투자 가이드라인 v3.docx</div>
                    <div class="document-item"><i class="fas fa-chart-line"></i> S&P ESG Index 과거 데이터.csv</div>`;
            } else {
                itemsHtml = `<p class="text-xs text-gray-400 p-2">이 워크스페이스에 추가된 자료가 없습니다.</p>`;
            }
            relatedMaterialsList.innerHTML = itemsHtml || `<p class="text-xs text-gray-400 p-2">관련 자료 없음</p>`;
        }

        function loadAiArtifacts(workspaceType) {
            aiArtifactsList.innerHTML = ''; // Clear previous
            let itemsHtml = '';
            if (workspaceType === 'market_research') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-invoice-dollar text-green-500"></i> AI 생성: 경쟁사 매출 비교 차트</div>
                    <div class="document-item"><i class="fas fa-lightbulb text-yellow-500"></i> AI 요약: 스마트홈 기술 특허 동향</div>`;
            } else if (workspaceType === 'investment_portfolio') {
                 itemsHtml = `
                    <div class="document-item"><i class="fas fa-history text-blue-500"></i> AI 실행: ESG 포트폴리오 백테스팅 결과_v1</div>
                    <div class="document-item"><i class="fas fa-clipboard-list text-purple-500"></i> AI 생성: 유망 ESG 기업 스크리닝 리스트</div>`;
            } else {
                 itemsHtml = `<p class="text-xs text-gray-400 p-2">생성된 AI 산출물이 없습니다.</p>`;
            }
            aiArtifactsList.innerHTML = itemsHtml || `<p class="text-xs text-gray-400 p-2">AI 산출물 없음</p>`;
        }
        
        function loadAiSuggestionsForWorkspace(workspaceType) { // Target div is suggestionListInWorkspace
            let suggestionsHtml = '';
            if (workspaceType === 'market_research') {
                suggestionsHtml = `<div class="p-3 bg-cyan-50 border border-cyan-200 rounded-md"><p class="font-medium text-cyan-700"><i class="fas fa-lightbulb mr-1"></i> 시장 조사 AI 제안:</p><p class="text-cyan-600 text-xs">"경쟁사 D의 최신 특허 출원 동향을 분석하여 기술적 위협을 평가해 보세요."</p><button class="text-xs mt-1 text-cyan-500 hover:underline">AI 특허 분석 요청</button></div>`;
            } else if (workspaceType === 'investment_portfolio') {
                 suggestionsHtml = `<div class="p-3 bg-teal-50 border border-teal-200 rounded-md"><p class="font-medium text-teal-700"><i class="fas fa-lightbulb mr-1"></i> 투자 AI 제안:</p><p class="text-teal-600 text-xs">"현재 포트폴리오의 ESG 스코어 변동 시나리오별 수익률 변화를 시뮬레이션 해보세요."</p><button class="text-xs mt-1 text-teal-500 hover:underline">AI 시나리오 분석</button></div>`;
            } else {
                suggestionsHtml = `<p class="text-xs text-gray-500">현재 워크스페이스에 대한 AI 제안이 없습니다.</p>`;
            }
            suggestionListInWorkspace.innerHTML = suggestionsHtml;
        }

        function loadWorkspaceTeamMembersRight(workspaceType) {
            // Mock members for the right panel (can be different from header for more detail)
            let membersHtml = `
                <div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/E2E8F0/333?text=김" class="w-6 h-6 rounded-full"><span class="text-xs">김팀장 (PM)</span> <i class="fas fa-circle text-green-500 text-xxs ml-auto" title="온라인"></i></div>
                <div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/A7F3D0/1C64F2?text=이" class="w-6 h-6 rounded-full"><span class="text-xs">이애널리스트</span> <i class="fas fa-circle text-green-500 text-xxs ml-auto" title="온라인"></i></div>`;
            if (workspaceType === 'investment_portfolio' || workspaceType === 'mna_dataroom') {
                 membersHtml += `<div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/FBCFE8/701A75?text=박" class="w-6 h-6 rounded-full"><span class="text-xs">박퀀트</span> <i class="far fa-circle text-gray-400 text-xxs ml-auto" title="오프라인"></i></div>`;
            }
            workspaceTeamMembersListRightElement.innerHTML = membersHtml;
        }


        function sendMainWorkspaceChatMessage() {
            const inputElement = document.getElementById('mainWorkspaceChatInput');
            const messageText = inputElement.value.trim();
            if (messageText === "") return;

            addChatMessage(mainWorkspaceChatArea, '김팀장 (나)', messageText, true);
            inputElement.value = ""; 

            // Simulate AI response based on workspace type and message
            setTimeout(() => {
                let aiResponse = `"${messageText}"에 대한 AI의 일반적인 답변입니다. (목업)`;
                let artifact = null;

                if (currentWorkspaceType === 'market_research' && messageText.toLowerCase().includes('경쟁사 분석')) {
                    aiResponse = `스마트홈 시장의 주요 경쟁사 A, B, C에 대한 분석을 시작합니다. 어떤 부분을 중점적으로 분석할까요? (예: 가격, 기능, 마케팅)`;
                    artifact = { title: '경쟁사 분석 시작됨', summary: '경쟁사 A, B, C 대상 분석 진행 중. 세부 항목 지정 필요.', icon: 'fa-magnifying-glass-chart' };
                    addAiArtifact("AI가 경쟁사 분석 시작함 (" + new Date().toLocaleTimeString() + ")");
                } else if (currentWorkspaceType === 'investment_portfolio' && messageText.toLowerCase().includes('백테스팅')) {
                    aiResponse = `글로벌 ESG 포트폴리오에 대한 백테스팅을 요청하셨습니다. 기간과 전략을 설정해주세요.`;
                    artifact = { title: '백테스팅 준비', summary: '기간, 전략 등 파라미터 설정 후 실행 가능합니다.', icon: 'fa-history', action: {label: '백테스팅 설정하기', func: 'alert', param: '백테스팅 설정 UI 목업'} };
                     addAiArtifact("AI 백테스팅 준비 완료 (" + new Date().toLocaleTimeString() + ")");
                } else if (messageText.toLowerCase().includes('요약해줘') && relatedMaterialsList.children.length > 0 && relatedMaterialsList.children[0].textContent !== '관련 자료가 여기에 표시됩니다.') {
                    const firstMaterial = relatedMaterialsList.children[0].textContent;
                    aiResponse = `'${firstMaterial}' 문서를 요약해 드리겠습니다. 잠시만 기다려주세요... (AI 요약 진행중)`;
                     artifact = { title: `문서 요약: ${firstMaterial}`, summary: 'AI가 문서를 분석하고 핵심 내용을 요약합니다...', icon: 'fa-file-lines' };
                     addAiArtifact(`AI가 '${firstMaterial}' 요약 시작 (${new Date().toLocaleTimeString()})`);
                }


                addChatMessage(mainWorkspaceChatArea, '워크스페이스 AI', aiResponse, false, false, artifact);
            }, 1000);
        }
        
        function aiSuggestMaterial() { // Mock function for AI suggesting material
            const newMaterialName = `AI 추천자료_${Math.floor(Math.random() * 100)}.pdf`;
            const item = document.createElement('div');
            item.className = 'document-item';
            item.innerHTML = `<i class="fas fa-file-alt text-purple-500"></i><span>${newMaterialName} (AI 제안)</span>`;
            item.onclick = () => alert(`'${newMaterialName}' 열기 (목업)`);
            
            if (relatedMaterialsList.firstChild && relatedMaterialsList.firstChild.textContent.includes('자료가 여기에 표시됩니다')) {
                relatedMaterialsList.innerHTML = ''; // Clear placeholder
            }
            relatedMaterialsList.appendChild(item);
            addChatMessage(mainWorkspaceChatArea, '워크스페이스 AI', `현재 논의와 관련하여 "${newMaterialName}" 자료를 제안합니다. '관련 자료' 목록에 추가했습니다.`, false);
            addAiArtifact(`AI가 '${newMaterialName}' 자료 제안 (${new Date().toLocaleTimeString()})`);
        }

        function addAiArtifact(logMessage) {
            const item = document.createElement('div');
            item.className = 'document-item text-xs py-1'; // Smaller text for log
            item.innerHTML = `<i class="fas fa-check-circle text-green-500"></i><span>${logMessage}</span>`;
            
             if (aiArtifactsList.firstChild && aiArtifactsList.firstChild.textContent.includes('AI 작업 결과가 여기에 기록됩니다')) {
                aiArtifactsList.innerHTML = ''; // Clear placeholder
            }
            aiArtifactsList.insertBefore(item, aiArtifactsList.firstChild); // Add to top
        }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            showPersonalAssistant(); 
        });
    </script>
</body>
</html>
