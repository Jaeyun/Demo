<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSearch AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; 
        }
        .chat-bubble {
            max-width: 85%; /* Increased width for artifact bubbles */
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .chat-bubble-user {
            background-color: #3b82f6; 
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        .chat-bubble-ai {
            background-color: #e5e7eb; 
            color: #1f2937; 
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        .chat-bubble-ai.personal-assistant { 
            background-color: #ede9fe; 
            color: #5b21b6; 
        }
        .chat-bubble-ai.personal-assistant .font-semibold {
             color: #6d28d9; 
        }
        .chat-bubble-system {
            background-color: #f9fafb; 
            color: #6b7280; 
            font-size: 0.875rem;
            text-align: center;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
        }
        .sidebar-item:hover {
            background-color: #e5e7eb;
        }
        .active-item { 
            background-color: #d1d5db; 
            font-weight: 600;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c4c4c4;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .news-item-clickable { 
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            padding: 8px;
            border-radius: 8px;
            margin-top: 4px; 
        }
        .news-item-clickable:hover {
            background-color: rgba(0,0,0,0.05);
        }
        .news-detail-card { 
            border: 1px solid #d1d5db; 
            border-radius: 8px;
            padding: 12px;
            background-color: #f9fafb; 
            margin-top: 8px;
        }
        .news-category-button {
            transition: background-color 0.2s, color 0.2s;
        }
        .news-category-button.active {
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
        }
        .news-list-item {
            border-bottom: 1px solid #e5e7eb;
        }
        .news-list-item:last-child {
            border-bottom: none;
        }
        .document-item { /* For right panel lists */
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .document-item:hover {
            background-color: #e0e7ff; /* Light indigo for hover */
        }
        .document-item i {
            margin-right: 8px;
            color: #6b7280;
        }
        .chat-content-scroll {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 0; 
        }
        .ai-artifact-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-top: 8px;
        }
        .ai-artifact-card h4 {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="flex h-screen antialiased text-gray-800">
    <!-- Left Sidebar -->
    <aside class="flex flex-col w-72 bg-gray-100 border-r border-gray-200 p-4 space-y-6 shrink-0">
        <div class="flex items-center space-x-3 px-2">
            <i class="fas fa-brain fa-2x text-blue-600"></i>
            <h1 class="text-2xl font-bold text-gray-800">DeepSearch AI</h1>
        </div>
        <div class="p-3 bg-white rounded-lg shadow">
            <div class="flex items-center space-x-3">
                <img src="https://placehold.co/40x40/E2E8F0/333?text=ê¹€" alt="ì‚¬ìš©ì í”„ë¡œí•„ ì‚¬ì§„" class="w-10 h-10 rounded-full">
                <div>
                    <p class="font-semibold text-gray-700">ê¹€íŒ€ì¥</p>
                    <p class="text-xs text-gray-500">ì „ëµê¸°íšíŒ€ / íŒ€ì¥</p>
                </div>
            </div>
            <button class="mt-3 w-full text-sm bg-red-500 hover:bg-red-600 text-white py-1.5 px-3 rounded-md transition duration-150">
                <i class="fas fa-sign-out-alt mr-1"></i> ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
        <div>
            <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-1">ê°œì¸ ë©”ë‰´</h2>
            <nav>
                 <a href="#personal-assistant" onclick="showPersonalAssistant(event)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item active-item">
                    <i class="fas fa-user-astronaut w-5 h-5 text-purple-500"></i>
                    <span>ê°œì¸ ì–´ì‹œìŠ¤í„´íŠ¸</span>
                </a>
            </nav>
        </div>
        <div>
            <div class="flex justify-between items-center mb-1 mt-3">
                <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</h2>
                <button class="text-blue-500 hover:text-blue-700 text-sm" title="ìƒˆ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë§Œë“¤ê¸°" onclick="alert('ìƒˆ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë§Œë“¤ê¸° ê¸°ëŠ¥ì€ ëª©ì—…ì…ë‹ˆë‹¤.')">
                    <i class="fas fa-plus-circle"></i> ìƒˆë¡œ ë§Œë“¤ê¸°
                </button>
            </div>
            <nav class="space-y-1">
                <a href="#ws-market-research" onclick="showGeneralizedWorkspaceView(event, 'ì‹œì¥ ì¡°ì‚¬: ìŠ¤ë§ˆíŠ¸í™ˆ ê²½ìŸ ë¶„ì„', 'market_research', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-search-dollar w-5 h-5 text-cyan-500"></i>
                    <span>ì‹œì¥ ì¡°ì‚¬: ìŠ¤ë§ˆíŠ¸í™ˆ</span>
                </a>
                <a href="#ws-new-business" onclick="showGeneralizedWorkspaceView(event, 'ì‹ ê·œ ì‚¬ì—…: AI ì½”ì¹­ ì„œë¹„ìŠ¤', 'new_business', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-lightbulb w-5 h-5 text-amber-500"></i>
                    <span>ì‹ ê·œ ì‚¬ì—…: AI ì½”ì¹­</span>
                </a>
                <a href="#ws-mna-beta" onclick="showGeneralizedWorkspaceView(event, 'M&A: ë² íƒ€ ì†”ë£¨ì…˜ ì¸ìˆ˜', 'mna_dataroom', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-handshake w-5 h-5 text-red-500"></i>
                    <span>M&A: ë² íƒ€ ì†”ë£¨ì…˜</span>
                    <span class="ml-auto inline-block px-2 py-0.5 text-xs font-semibold bg-red-100 text-red-600 rounded-full">Hot</span>
                </a>
                <a href="#ws-proposal-bigcorp" onclick="showGeneralizedWorkspaceView(event, 'ê³ ê° ì œì•ˆ: ë¹…í…Œí¬ Corp', 'customer_proposal', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-file-signature w-5 h-5 text-blue-500"></i>
                    <span>ì œì•ˆ: ë¹…í…Œí¬ Corp</span>
                </a>
                <a href="#ws-meeting-q3" onclick="showGeneralizedWorkspaceView(event, 'íšŒì˜: 3ë¶„ê¸° ì „ëµ ì›Œí¬ìƒµ', 'meeting_management', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-users w-5 h-5 text-lime-500"></i>
                    <span>íšŒì˜: 3ë¶„ê¸° ì „ëµ ì›Œí¬ìƒµ</span>
                </a>
                <a href="#ws-report-marketing" onclick="showGeneralizedWorkspaceView(event, 'ë³´ê³ ì„œ: ì›”ê°„ ë§ˆì¼€íŒ… ì„±ê³¼', 'reporting', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-chart-line w-5 h-5 text-green-500"></i>
                    <span>ë³´ê³ ì„œ: ë§ˆì¼€íŒ… ì„±ê³¼</span>
                </a>
                 <a href="#ws-legal-privacy" onclick="showGeneralizedWorkspaceView(event, 'ë²•ë¥  ê²€í† : ê°œì¸ì •ë³´ë³´í˜¸ë²•', 'legal_review', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-gavel w-5 h-5 text-gray-500"></i>
                    <span>ë²•ë¥  ê²€í† : ê°œì¸ì •ë³´ë³´í˜¸</span>
                </a>
                <a href="#ws-investment-esg" onclick="showGeneralizedWorkspaceView(event, 'íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤: ê¸€ë¡œë²Œ ESG', 'investment_portfolio', this)" class="flex items-center space-x-2 px-3 py-2.5 rounded-md text-sm font-medium text-gray-700 sidebar-item">
                    <i class="fas fa-chart-pie w-5 h-5 text-teal-500"></i>
                    <span>íˆ¬ì: ê¸€ë¡œë²Œ ESG í€ë“œ</span>
                </a>
            </nav>
        </div>
        <div>
            <h2 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 mt-3">ë°ì´í„°ë² ì´ìŠ¤</h2>
            <div class="space-y-1">
                <a href="#news-feed" onclick="showNewsFeedView(event)" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-globe w-5 h-5 text-gray-500"></i><span>ë‰´ìŠ¤ í”¼ë“œ</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>ê³µì‹œ</span></a>
                 <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>íŠ¹í—ˆ</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-folder-open w-5 h-5 text-gray-500"></i><span>ë¦¬ì„œì¹˜</span></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-database w-5 h-5 text-indigo-500"></i><span>ê¸°ì—… ì •ë³´</span><i class="fas fa-lock text-xs text-gray-400 ml-auto" title="ìœ ë£Œ êµ¬ë… í•„ìš”"></i></a>
                <a href="#" class="flex items-center space-x-2 px-3 py-2 rounded-md text-sm text-gray-700 sidebar-item"><i class="fas fa-dollar-sign w-5 h-5 text-teal-500"></i><span>íˆ¬ì ì •ë³´</span><i class="fas fa-lock text-xs text-gray-400 ml-auto" title="ìœ ë£Œ êµ¬ë… í•„ìš”"></i></a>
            </div>
        </div>
        <div class="mt-auto p-2 text-center"><p class="text-xs text-gray-500">&copy; 2025 ë”¥ì„œì¹˜ AI</p></div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col bg-white overflow-hidden">
        <div id="mainContentArea" class="flex-1 flex flex-col overflow-hidden"> 
            <!-- Personal Assistant View -->
            <div id="personalAssistantView" class="hidden flex-1 flex-col overflow-hidden"> 
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0"> 
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-user-astronaut text-purple-500 mr-2"></i> ê°œì¸ ì–´ì‹œìŠ¤í„´íŠ¸
                        </h2>
                        <button class="text-gray-500 hover:text-gray-700" title="ì–´ì‹œìŠ¤í„´íŠ¸ ì„¤ì •">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                </header>
                <div id="personalChatArea" class="chat-content-scroll p-6 space-y-4"></div>
                <div class="bg-gray-50 p-4 border-t border-gray-200 shrink-0"> 
                    <div class="flex items-center space-x-3">
                        <button class="text-gray-500 hover:text-gray-700" title="íŒŒì¼ ì²¨ë¶€"><i class="fas fa-paperclip fa-lg"></i></button>
                        <input type="text" id="personalChatInput" placeholder="AI ë¹„ì„œì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê±°ë‚˜ ì‘ì—…ì„ ìš”ì²­í•˜ì„¸ìš”..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition duration-150">
                        <button class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-150" title="ì „ì†¡" onclick="sendPersonalChatMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- Generalized Workspace View (Chat-centric) -->
            <div id="generalizedWorkspaceView" class="hidden flex-1 flex-col overflow-hidden">
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0">
                    <div class="flex items-center justify-between">
                        <h2 id="generalizedWorkspaceTitle" class="text-xl font-semibold text-gray-800 flex items-center">
                            <i id="generalizedWorkspaceIcon" class="fas fa-briefcase mr-2"></i> 
                            <span>ì¼ë°˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</span>
                        </h2>
                        <div class="flex items-center space-x-3">
                             <button class="text-gray-500 hover:text-gray-700" title="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •"><i class="fas fa-cog fa-lg"></i></button>
                             <div id="generalizedWorkspaceMembers" class="flex -space-x-2 overflow-hidden">
                                <!-- Members will be loaded by JS -->
                            </div>
                        </div>
                    </div>
                </header>

                <div class="flex-1 flex min-h-0"> <!-- Main content area with chat and right panel -->
                    <!-- Central Chat Area -->
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <div id="mainWorkspaceChatArea" class="chat-content-scroll p-6 space-y-4">
                            <!-- Chat messages will be appended here by JS -->
                        </div>
                        <div class="bg-gray-50 p-4 border-t border-gray-200 shrink-0">
                            <div class="flex items-center space-x-3">
                                <button class="text-gray-500 hover:text-gray-700" title="íŒŒì¼ ì²¨ë¶€">
                                    <i class="fas fa-paperclip fa-lg"></i>
                                </button>
                                <input type="text" id="mainWorkspaceChatInput" placeholder="AIì—ê²Œ ìš”ì²­í•˜ê±°ë‚˜ íŒ€ì›ê³¼ ëŒ€í™”í•˜ì„¸ìš”..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition duration-150">
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-150" onclick="sendMainWorkspaceChatMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Contextual Panel -->
                    <aside class="w-96 bg-gray-50 border-l border-gray-200 p-4 flex flex-col space-y-4 overflow-y-auto shrink-0">
                        <div>
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 flex items-center">
                                <i class="fas fa-folder-open mr-2 text-yellow-500"></i> ê´€ë ¨ ìë£Œ
                                <button class="ml-auto text-xs text-blue-500 hover:text-blue-700" onclick="aiSuggestMaterial()">AI ìë£Œ ì œì•ˆ</button>
                            </h3>
                            <div id="relatedMaterialsList" class="space-y-1 text-sm max-h-60 overflow-y-auto bg-white p-2 rounded-md border">
                                 <p class="text-xs text-gray-400 p-2">ê´€ë ¨ ìë£Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                            </div>
                            <button class="mt-2 w-full text-xs text-gray-600 hover:text-gray-800 py-1.5 px-2 rounded-md border border-gray-300 hover:bg-gray-100">
                                <i class="fas fa-plus-circle mr-1"></i> ìë£Œ ì¶”ê°€/ì—…ë¡œë“œ
                            </button>
                        </div>
                        <hr>
                        <div>
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2 flex items-center">
                                <i class="fas fa-cogs mr-2 text-indigo-500"></i> AI ì‘ì—… ë¡œê·¸ & ì‚°ì¶œë¬¼
                            </h3>
                            <div id="aiArtifactsList" class="space-y-1 text-sm max-h-60 overflow-y-auto bg-white p-2 rounded-md border">
                                 <p class="text-xs text-gray-400 p-2">AI ì‘ì—… ê²°ê³¼ê°€ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <hr>
                        <div id="aiSuggestionsSectionInWorkspace">
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2"><i class="fas fa-lightbulb text-yellow-400 mr-1"></i> AI ì œì•ˆ</h3>
                            <div id="suggestionListInWorkspace" class="space-y-2 text-sm">
                                 <p class="text-xs text-gray-500">AI ì œì•ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                         <hr>
                        <div id="workspaceTeamMembersSection">
                            <h3 class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">íŒ€ ë©¤ë²„</h3>
                            <div id="workspaceTeamMembersListRight" class="space-y-2 text-sm">
                                <!-- Team members list for the current workspace -->
                            </div>
                        </div>
                    </aside>
                </div>
            </div>


            <!-- News Feed View (remains the same as previous version) -->
            <div id="newsFeedView" class="hidden flex-1 flex-col overflow-hidden">
                <header class="bg-gray-50 border-b border-gray-200 p-4 shrink-0">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center"><i class="fas fa-newspaper text-orange-500 mr-2"></i> ë‰´ìŠ¤ í”¼ë“œ</h2>
                        <div class="flex items-center space-x-2">
                            <input type="text" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰..." class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            <button class="text-gray-500 hover:text-orange-600" title="í•„í„°"><i class="fas fa-filter"></i></button>
                        </div>
                    </div>
                </header>
                <div class="p-4 shrink-0 border-b border-gray-200">
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        <button onclick="showNewsCategory('my-feed', this)" class="news-category-button active px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">ë‚´ í”¼ë“œ</button>
                        <button onclick="showNewsCategory('top-issues', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">ì˜¤ëŠ˜ì˜ ì£¼ìš” ì´ìŠˆ</button>
                        <button onclick="showNewsCategory('politics', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">ì •ì¹˜</button>
                        <button onclick="showNewsCategory('economy', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">ê²½ì œ</button>
                         <button onclick="showNewsCategory('society', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">ì‚¬íšŒ</button>
                        <button onclick="showNewsCategory('it-science', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">IT/ê³¼í•™</button>
                        <button onclick="showNewsCategory('world', this)" class="news-category-button px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-md">êµ­ì œ</button>
                    </div>
                </div>
                <div id="newsListArea" class="chat-content-scroll p-6"></div>
            </div>
        </div>
    </main>

    <!-- Right Sidebar (This is now part of the generalized workspace for its contextual content) -->
    <!-- The global right sidebar is removed as its content is now integrated into the right panel of generalizedWorkspaceView -->

    <script>
        // --- DOM Elements ---
        const personalAssistantView = document.getElementById('personalAssistantView');
        const generalizedWorkspaceView = document.getElementById('generalizedWorkspaceView');
        const newsFeedView = document.getElementById('newsFeedView'); 
        
        const generalizedWorkspaceTitleElement = document.getElementById('generalizedWorkspaceTitle').querySelector('span');
        const generalizedWorkspaceIconElement = document.getElementById('generalizedWorkspaceIcon');
        const generalizedWorkspaceMembersElement = document.getElementById('generalizedWorkspaceMembers'); // For header
        const workspaceTeamMembersListRightElement = document.getElementById('workspaceTeamMembersListRight'); // For right panel

        const personalChatArea = document.getElementById('personalChatArea');
        const mainWorkspaceChatArea = document.getElementById('mainWorkspaceChatArea'); // Central chat for generalized workspace
        const newsListArea = document.getElementById('newsListArea'); 
        
        const relatedMaterialsList = document.getElementById('relatedMaterialsList');
        const aiArtifactsList = document.getElementById('aiArtifactsList');
        const suggestionListInWorkspace = document.getElementById('suggestionListInWorkspace'); // Renamed

        const sidebarLinks = document.querySelectorAll('.sidebar-item');
        
        // Removed global attachedFilesSection, fileList, aiSuggestionsSection, suggestionList as they are now part of the right panel of generalizedWorkspaceView
        
        let currentWorkspaceType = null; 
        let currentWorkspaceName = '';
        let backtestingChartInstance = null; // Keep this for potential charts in AI artifacts

        // --- Utility Functions ---
        function hideAllMainViews() {
            personalAssistantView.classList.add('hidden');
            personalAssistantView.classList.remove('flex', 'flex-col');
            generalizedWorkspaceView.classList.add('hidden');
            generalizedWorkspaceView.classList.remove('flex', 'flex-col');
            newsFeedView.classList.add('hidden');
            newsFeedView.classList.remove('flex', 'flex-col');
        }

        function setActiveLink(selectedLink) {
            sidebarLinks.forEach(link => link.classList.remove('active-item'));
            if (selectedLink) selectedLink.classList.add('active-item');
        }

        function addChatMessage(chatAreaElement, sender, message, isUser, isPersonalAssistant = false, artifact = null) {
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble');
            if (isUser) {
                bubble.classList.add('chat-bubble-user');
            } else {
                bubble.classList.add('chat-bubble-ai');
                if (isPersonalAssistant) {
                    bubble.classList.add('personal-assistant');
                }
            }

            let senderHtml = `<p class="font-semibold text-sm mb-0.5">${sender}</p>`;
            if (!isUser) {
                let iconClass = 'fas fa-robot text-indigo-500'; // Default for workspace AI
                if (isPersonalAssistant) iconClass = 'fas fa-user-astronaut text-purple-500';
                senderHtml = `<p class="font-semibold text-sm mb-0.5"><i class="${iconClass} mr-1"></i> ${sender}</p>`;
            }
            
            let messageHtml = `<p>${message}</p>`;
            if (artifact) {
                messageHtml += `
                    <div class="ai-artifact-card">
                        <h4><i class="fas ${artifact.icon || 'fa-file-alt'} mr-2 text-gray-500"></i>${artifact.title}</h4>
                        <p class="text-xs text-gray-600">${artifact.summary}</p>
                        ${artifact.action ? `<button class="text-xs mt-2 bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded" onclick="${artifact.action.func}('${artifact.action.param}')">${artifact.action.label}</button>` : ''}
                    </div>`;
            }

            bubble.innerHTML = senderHtml + messageHtml;
            chatAreaElement.appendChild(bubble);
            chatAreaElement.scrollTop = chatAreaElement.scrollHeight;
        }
        
        // --- Personal Assistant Functions ---
        function initializePersonalAssistantChat() {
            personalChatArea.innerHTML = ''; 
            addChatMessage(personalChatArea, 'ê°œì¸ AI ë¹„ì„œ', 'ë°˜ê°‘ìŠµë‹ˆë‹¤, ê¹€íŒ€ì¥ë‹˜! ì˜¤ëŠ˜ ì—…ë¬´ë¥¼ ì‹œì‘í•´ ë³¼ê¹Œìš”? <i class="fas fa-rocket text-purple-400"></i>', false, true);
            addChatMessage(personalChatArea, 'ê°œì¸ AI ë¹„ì„œ', 'ì˜¤ëŠ˜ ê¹€íŒ€ì¥ë‹˜ì´ ì±™ê²¨ë³¼ ë§Œí•œ ì£¼ìš” ë‰´ìŠ¤ì…ë‹ˆë‹¤. í´ë¦­í•˜ì‹œë©´ ìƒì„¸ ë‚´ìš©ì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:', false, true, {
                title: 'ë‰´ìŠ¤ ì•„í‹°í´ (ì˜ˆì‹œ)',
                summary: 'ê¸€ë¡œë²Œ AI ì‹œì¥, ì—°í‰ê·  30% ì„±ì¥ ì „ë§. ABC ë‰´ìŠ¤ - 1ì‹œê°„ ì „. ìµœì‹  ë³´ê³ ì„œì— ë”°ë¥´ë©´...',
                icon: 'fa-newspaper',
                action: { label: 'ìì„¸íˆ ë³´ê¸°', func: 'alert', param: 'ë‰´ìŠ¤ ìƒì„¸ ë³´ê¸° ëª©ì—…' }
            });
        }

        function showPersonalAssistant(event) {
            if(event) event.preventDefault();
            hideAllMainViews();
            personalAssistantView.classList.remove('hidden');
            personalAssistantView.classList.add('flex', 'flex-col'); 
            setActiveLink(document.querySelector('a[href="#personal-assistant"]'));
            initializePersonalAssistantChat(); 
            // Right panel for personal assistant (simplified or different content)
            relatedMaterialsList.innerHTML = `<p class="text-xs text-gray-400 p-2">ê°œì¸ ì‘ì—… ê´€ë ¨ íŒŒì¼ ë˜ëŠ” ë…¸íŠ¸ë¥¼ ì—¬ê¸°ì— í‘œì‹œí•©ë‹ˆë‹¤.</p>`;
            aiArtifactsList.innerHTML = `<p class="text-xs text-gray-400 p-2">ìµœê·¼ ê°œì¸ AI ì‘ì—… ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>`;
            workspaceTeamMembersListRightElement.innerHTML = `<p class="text-xs text-gray-500">ê°œì¸ ì–´ì‹œìŠ¤í„´íŠ¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.</p>`;
            suggestionListInWorkspace.innerHTML = `
                <div class="p-3 bg-purple-50 border border-purple-200 rounded-md">
                    <p class="font-medium text-purple-700">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•  ì¼ ì œì•ˆ:</p>
                    <p class="text-purple-600 text-xs">"ì˜¤í›„ 2ì‹œ ë¹…í…Œí¬ Corp ì œì•ˆ ì¤€ë¹„ ìƒíƒœ ì ê²€."</p>
                    <button class="text-xs mt-1 text-purple-500 hover:underline" onclick="showGeneralizedWorkspaceView(null, 'ê³ ê° ì œì•ˆ: ë¹…í…Œí¬ Corp', 'customer_proposal', document.querySelector('a[href=\\'#ws-proposal-bigcorp\\']'))">ê´€ë ¨ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê°€ê¸°</button>
                </div>`;
        }
        
        function sendPersonalChatMessage() {
            const inputElement = document.getElementById('personalChatInput');
            const messageText = inputElement.value.trim();
            if (messageText === "") return;
            addChatMessage(personalChatArea, 'ê¹€íŒ€ì¥ (ë‚˜)', messageText, true, true);
            inputElement.value = ""; 
            setTimeout(() => {
                addChatMessage(personalChatArea, 'ê°œì¸ AI ë¹„ì„œ', `ì•Œê² ìŠµë‹ˆë‹¤, ê¹€íŒ€ì¥ë‹˜. ìš”ì²­í•˜ì‹  "<span class="font-medium">${messageText}</span>"ì— ëŒ€í•´ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. (ëª©ì—… ì‘ë‹µ)`, false, true, {
                    title: 'ìš”ì²­ ì²˜ë¦¬ ê²°ê³¼ (ì˜ˆì‹œ)',
                    summary: 'ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ìš”ì•½í–ˆìŠµë‹ˆë‹¤. í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                    icon: 'fa-check-circle',
                    action: { label: 'ê²°ê³¼ ë³´ê¸°', func: 'alert', param: 'AI ìš”ì²­ ì²˜ë¦¬ ê²°ê³¼ ëª©ì—…' }
                });
            }, 1000);
        }
        
        // --- News Feed Functions (remains mostly the same) ---
        function showNewsFeedView(event) {
             if(event) event.preventDefault();
            hideAllMainViews();
            newsFeedView.classList.remove('hidden');
            newsFeedView.classList.add('flex', 'flex-col');
            setActiveLink(document.querySelector('a[href="#news-feed"]'));
            showNewsCategory('my-feed', document.querySelector('#newsFeedView .news-category-button')); 
            // Right panel content for news feed
            relatedMaterialsList.innerHTML = `<p class="text-xs text-gray-400 p-2">ìŠ¤í¬ë©í•œ ë‰´ìŠ¤ë‚˜ ê´€ë ¨ ë©”ëª¨ë¥¼ ì—¬ê¸°ì— í‘œì‹œí•©ë‹ˆë‹¤.</p>`;
            aiArtifactsList.innerHTML = `<p class="text-xs text-gray-400 p-2">ë‰´ìŠ¤ ìš”ì•½ AI ì‘ì—… ë¡œê·¸.</p>`;
            workspaceTeamMembersListRightElement.innerHTML = `<p class="text-xs text-gray-500">ë‰´ìŠ¤ í”¼ë“œ ë³´ê¸° ì¤‘ì…ë‹ˆë‹¤.</p>`;
            suggestionListInWorkspace.innerHTML = `<div class="p-3 bg-orange-50 border border-orange-200 rounded-md"><p class="font-medium text-orange-700">ğŸ“° ë‰´ìŠ¤ í•„í„°ë§ íŒ:</p><p class="text-orange-600 text-xs">"í‚¤ì›Œë“œ ê²€ìƒ‰ì´ë‚˜ í•„í„° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ë‰´ìŠ¤ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì•„ë³´ì„¸ìš”."</p></div>`;
        }

        function showNewsCategory(category, buttonElement) {
            const buttons = document.querySelectorAll('#newsFeedView .news-category-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            if(buttonElement) buttonElement.classList.add('active');
            newsListArea.innerHTML = ''; 
            let articlesHtml = `<h3 class="text-lg font-semibold text-gray-700 mb-4">"${getCategoryDisplayName(category)}" ê´€ë ¨ ë‰´ìŠ¤</h3>`;
            const mockNews = {
                'my-feed': [{ title: "ë‚´ í”¼ë“œ ë§ì¶¤í˜• ë‰´ìŠ¤ 1: AIê°€ ì¶”ì²œí•˜ëŠ” ì˜¤ëŠ˜ì˜ ì£¼ìš” ê¸°ìˆ  ë™í–¥", source: "TechCrunch", time: "30ë¶„ ì „", summary: "ìƒì„±í˜• AI ëª¨ë¸ì˜ ìƒˆë¡œìš´ ë°œì „ê³¼ ì‚°ì—… ì ìš© ì‚¬ë¡€ ì‹¬ì¸µ ë¶„ì„...", link: "#" }],
                'top-issues': [{ title: "ì˜¤ëŠ˜ì˜ ì£¼ìš” ì´ìŠˆ 1: ê¸€ë¡œë²Œ ê³µê¸‰ë§ ìœ„ê¸°, ë°˜ë„ì²´ ì‚°ì—… ì˜í–¥ì€?", source: "Reuters", time: "2ì‹œê°„ ì „", summary: "ì§€ì •í•™ì  ê¸´ì¥ê³¼ ë¬¼ë¥˜ ëŒ€ë€ì´ ë°˜ë„ì²´ ìˆ˜ê¸‰ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„...", link: "#" }],
                'politics': [{ title: "ì •ì¹˜ ë‰´ìŠ¤ 1: ì—¬ì•¼, ì£¼ìš” ë²•ì•ˆ ì²˜ë¦¬ ë‘ê³  ëŒ€ë¦½", source: "ì—°í•©ë‰´ìŠ¤", time: "1ì‹œê°„ ì „", summary: "êµ­íšŒ ë³¸íšŒì˜ë¥¼ ì•ë‘ê³  ì£¼ìš” ìŸì  ë²•ì•ˆì— ëŒ€í•œ ì—¬ì•¼ ê°„ ì…ì¥ ì°¨ì´ ì—¬ì „...", link: "#"}]
            };
            const articles = mockNews[category] || [{ title: "ì„ íƒí•˜ì‹  ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.", source: "", time: "", summary: "", link: "#"}];
             articles.forEach(article => {
                articlesHtml += `<div class="news-list-item py-4"><a href="${article.link}" target="_blank" class="hover:text-indigo-600"><h4 class="text-md font-semibold text-gray-800">${article.title}</h4></a><div class="text-xs text-gray-500 mt-1"><span>${article.source}</span>${article.source && article.time ? '<span class="mx-1">|</span>' : ''}<span>${article.time}</span></div><p class="text-sm text-gray-600 mt-2">${article.summary}</p><div class="mt-2"><button class="text-xs text-indigo-500 hover:underline">ìì„¸íˆ ë³´ê¸°</button><button class="text-xs text-gray-500 hover:underline ml-2">ê´€ë ¨ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ê³µìœ </button></div></div>`;
            });
            newsListArea.innerHTML = articlesHtml;
            newsListArea.scrollTop = 0; 
        }

        function getCategoryDisplayName(categoryKey) {
            const names = {'my-feed': 'ë‚´ í”¼ë“œ', 'top-issues': 'ì˜¤ëŠ˜ì˜ ì£¼ìš” ì´ìŠˆ', 'politics': 'ì •ì¹˜', 'economy': 'ê²½ì œ', 'society': 'ì‚¬íšŒ', 'it-science': 'IT/ê³¼í•™', 'world': 'êµ­ì œ'};
            return names[categoryKey] || categoryKey;
        }

        // --- Generalized Workspace Functions (NEW CHAT-CENTRIC UI) ---
        function showGeneralizedWorkspaceView(event, workspaceNameFromLink, type, linkElement) {
            if(event) event.preventDefault();
            hideAllMainViews();
            generalizedWorkspaceView.classList.remove('hidden');
            generalizedWorkspaceView.classList.add('flex', 'flex-col');
            
            currentWorkspaceType = type; 
            currentWorkspaceName = workspaceNameFromLink;
            generalizedWorkspaceTitleElement.textContent = currentWorkspaceName;
            setActiveLink(linkElement || (event ? event.currentTarget : null));

            const iconClasses = {
                'market_research': 'fa-search-dollar text-cyan-500', 'new_business': 'fa-lightbulb text-amber-500',
                'mna_dataroom': 'fa-handshake text-red-500', 'customer_proposal': 'fa-file-signature text-blue-500',
                'meeting_management': 'fa-users text-lime-500', 'reporting': 'fa-chart-line text-green-500',
                'legal_review': 'fa-gavel text-gray-500', 'investment_portfolio': 'fa-chart-pie text-teal-500',
                'default': 'fa-briefcase text-gray-700'
            };
            generalizedWorkspaceIconElement.className = `fas ${iconClasses[type] || iconClasses['default']} mr-2`;

            // Mock members in header
            generalizedWorkspaceMembersElement.innerHTML = `
                <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white" src="https://placehold.co/32x32/E2E8F0/333?text=ê¹€" alt="ê¹€íŒ€ì¥">
                <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white" src="https://placehold.co/32x32/A7F3D0/1C64F2?text=ì´" alt="ì´ì• ë„ë¦¬ìŠ¤íŠ¸">
                <a class="flex items-center justify-center h-8 w-8 rounded-full ring-2 ring-white bg-gray-200 text-xs font-medium text-gray-600 hover:bg-gray-300" href="#">+${Math.floor(Math.random() * 3) + 1}</a>`;
            
            // Initialize main chat area for the workspace
            mainWorkspaceChatArea.innerHTML = '';
            let initialAiMessage = `ì•ˆë…•í•˜ì„¸ìš”, ê¹€íŒ€ì¥ë‹˜. "${currentWorkspaceName}" ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?`;
            if (type === 'market_research') {
                initialAiMessage = `"${currentWorkspaceName}" ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ìŠ¤ë§ˆíŠ¸í™ˆ ì‹œì¥ì˜ ê²½ìŸì‚¬ ë¶„ì„, ì‹œì¥ ë™í–¥ íŒŒì•… ë“± AIì—ê²Œ ìš”ì²­í•´ë³´ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´, "ìµœê·¼ 3ê°œì›”ê°„ ìŠ¤ë§ˆíŠ¸í™ˆ ë³´ì•ˆ ê¸°ìˆ  ê´€ë ¨ ë‰´ìŠ¤ ìš”ì•½í•´ì¤˜" ì™€ ê°™ì´ ì§ˆë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            } else if (type === 'investment_portfolio') {
                 initialAiMessage = `"${currentWorkspaceName}" ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì…ë‹ˆë‹¤. AIì™€ í•¨ê»˜ ê¸€ë¡œë²Œ ESG íˆ¬ì ì „ëµì„ ìˆ˜ë¦½í•˜ê³  ë°±í…ŒìŠ¤íŒ…ì„ ì§„í–‰í•´ ë³´ì„¸ìš”. "ìœ ë§ ESG ê¸°ì—… ë¦¬ìŠ¤íŠ¸ ë¶„ì„í•´ì¤˜" ë˜ëŠ” "íŠ¹ì • ESG í…Œë§ˆì˜ ê³¼ê±° ìˆ˜ìµë¥  ì•Œë ¤ì¤˜" ë“±ìœ¼ë¡œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
            }
            addChatMessage(mainWorkspaceChatArea, 'ì›Œí¬ìŠ¤í˜ì´ìŠ¤ AI', initialAiMessage, false);

            // Initialize right panel content
            loadRelatedMaterials(type);
            loadAiArtifacts(type);
            loadAiSuggestionsForWorkspace(type); // Re-using this function, target div is suggestionListInWorkspace
            loadWorkspaceTeamMembersRight(type);
        }

        function loadRelatedMaterials(workspaceType) {
            relatedMaterialsList.innerHTML = ''; // Clear previous
            let itemsHtml = '';
            if (workspaceType === 'market_research') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-pdf"></i> ìŠ¤ë§ˆíŠ¸í™ˆ ì‹œì¥ ë³´ê³ ì„œ_2024.pdf</div>
                    <div class="document-item"><i class="fas fa-link"></i> ê²½ìŸì‚¬ A í™ˆí˜ì´ì§€</div>
                    <div class="document-item"><i class="fas fa-table"></i> ì†Œë¹„ì ì„¤ë¬¸ì¡°ì‚¬ Raw Data.xlsx</div>`;
            } else if (workspaceType === 'investment_portfolio') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-alt"></i> ESG íˆ¬ì ê°€ì´ë“œë¼ì¸ v3.docx</div>
                    <div class="document-item"><i class="fas fa-chart-line"></i> S&P ESG Index ê³¼ê±° ë°ì´í„°.csv</div>`;
            } else {
                itemsHtml = `<p class="text-xs text-gray-400 p-2">ì´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ì¶”ê°€ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
            relatedMaterialsList.innerHTML = itemsHtml || `<p class="text-xs text-gray-400 p-2">ê´€ë ¨ ìë£Œ ì—†ìŒ</p>`;
        }

        function loadAiArtifacts(workspaceType) {
            aiArtifactsList.innerHTML = ''; // Clear previous
            let itemsHtml = '';
            if (workspaceType === 'market_research') {
                itemsHtml = `
                    <div class="document-item"><i class="fas fa-file-invoice-dollar text-green-500"></i> AI ìƒì„±: ê²½ìŸì‚¬ ë§¤ì¶œ ë¹„êµ ì°¨íŠ¸</div>
                    <div class="document-item"><i class="fas fa-lightbulb text-yellow-500"></i> AI ìš”ì•½: ìŠ¤ë§ˆíŠ¸í™ˆ ê¸°ìˆ  íŠ¹í—ˆ ë™í–¥</div>`;
            } else if (workspaceType === 'investment_portfolio') {
                 itemsHtml = `
                    <div class="document-item"><i class="fas fa-history text-blue-500"></i> AI ì‹¤í–‰: ESG í¬íŠ¸í´ë¦¬ì˜¤ ë°±í…ŒìŠ¤íŒ… ê²°ê³¼_v1</div>
                    <div class="document-item"><i class="fas fa-clipboard-list text-purple-500"></i> AI ìƒì„±: ìœ ë§ ESG ê¸°ì—… ìŠ¤í¬ë¦¬ë‹ ë¦¬ìŠ¤íŠ¸</div>`;
            } else {
                 itemsHtml = `<p class="text-xs text-gray-400 p-2">ìƒì„±ëœ AI ì‚°ì¶œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
            aiArtifactsList.innerHTML = itemsHtml || `<p class="text-xs text-gray-400 p-2">AI ì‚°ì¶œë¬¼ ì—†ìŒ</p>`;
        }
        
        function loadAiSuggestionsForWorkspace(workspaceType) { // Target div is suggestionListInWorkspace
            let suggestionsHtml = '';
            if (workspaceType === 'market_research') {
                suggestionsHtml = `<div class="p-3 bg-cyan-50 border border-cyan-200 rounded-md"><p class="font-medium text-cyan-700"><i class="fas fa-lightbulb mr-1"></i> ì‹œì¥ ì¡°ì‚¬ AI ì œì•ˆ:</p><p class="text-cyan-600 text-xs">"ê²½ìŸì‚¬ Dì˜ ìµœì‹  íŠ¹í—ˆ ì¶œì› ë™í–¥ì„ ë¶„ì„í•˜ì—¬ ê¸°ìˆ ì  ìœ„í˜‘ì„ í‰ê°€í•´ ë³´ì„¸ìš”."</p><button class="text-xs mt-1 text-cyan-500 hover:underline">AI íŠ¹í—ˆ ë¶„ì„ ìš”ì²­</button></div>`;
            } else if (workspaceType === 'investment_portfolio') {
                 suggestionsHtml = `<div class="p-3 bg-teal-50 border border-teal-200 rounded-md"><p class="font-medium text-teal-700"><i class="fas fa-lightbulb mr-1"></i> íˆ¬ì AI ì œì•ˆ:</p><p class="text-teal-600 text-xs">"í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ì˜ ESG ìŠ¤ì½”ì–´ ë³€ë™ ì‹œë‚˜ë¦¬ì˜¤ë³„ ìˆ˜ìµë¥  ë³€í™”ë¥¼ ì‹œë®¬ë ˆì´ì…˜ í•´ë³´ì„¸ìš”."</p><button class="text-xs mt-1 text-teal-500 hover:underline">AI ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„</button></div>`;
            } else {
                suggestionsHtml = `<p class="text-xs text-gray-500">í˜„ì¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ëŒ€í•œ AI ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }
            suggestionListInWorkspace.innerHTML = suggestionsHtml;
        }

        function loadWorkspaceTeamMembersRight(workspaceType) {
            // Mock members for the right panel (can be different from header for more detail)
            let membersHtml = `
                <div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/E2E8F0/333?text=ê¹€" class="w-6 h-6 rounded-full"><span class="text-xs">ê¹€íŒ€ì¥ (PM)</span> <i class="fas fa-circle text-green-500 text-xxs ml-auto" title="ì˜¨ë¼ì¸"></i></div>
                <div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/A7F3D0/1C64F2?text=ì´" class="w-6 h-6 rounded-full"><span class="text-xs">ì´ì• ë„ë¦¬ìŠ¤íŠ¸</span> <i class="fas fa-circle text-green-500 text-xxs ml-auto" title="ì˜¨ë¼ì¸"></i></div>`;
            if (workspaceType === 'investment_portfolio' || workspaceType === 'mna_dataroom') {
                 membersHtml += `<div class="flex items-center space-x-2"><img src="https://placehold.co/24x24/FBCFE8/701A75?text=ë°•" class="w-6 h-6 rounded-full"><span class="text-xs">ë°•í€€íŠ¸</span> <i class="far fa-circle text-gray-400 text-xxs ml-auto" title="ì˜¤í”„ë¼ì¸"></i></div>`;
            }
            workspaceTeamMembersListRightElement.innerHTML = membersHtml;
        }


        function sendMainWorkspaceChatMessage() {
            const inputElement = document.getElementById('mainWorkspaceChatInput');
            const messageText = inputElement.value.trim();
            if (messageText === "") return;

            addChatMessage(mainWorkspaceChatArea, 'ê¹€íŒ€ì¥ (ë‚˜)', messageText, true);
            inputElement.value = ""; 

            // Simulate AI response based on workspace type and message
            setTimeout(() => {
                let aiResponse = `"${messageText}"ì— ëŒ€í•œ AIì˜ ì¼ë°˜ì ì¸ ë‹µë³€ì…ë‹ˆë‹¤. (ëª©ì—…)`;
                let artifact = null;

                if (currentWorkspaceType === 'market_research' && messageText.toLowerCase().includes('ê²½ìŸì‚¬ ë¶„ì„')) {
                    aiResponse = `ìŠ¤ë§ˆíŠ¸í™ˆ ì‹œì¥ì˜ ì£¼ìš” ê²½ìŸì‚¬ A, B, Cì— ëŒ€í•œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ì–´ë–¤ ë¶€ë¶„ì„ ì¤‘ì ì ìœ¼ë¡œ ë¶„ì„í• ê¹Œìš”? (ì˜ˆ: ê°€ê²©, ê¸°ëŠ¥, ë§ˆì¼€íŒ…)`;
                    artifact = { title: 'ê²½ìŸì‚¬ ë¶„ì„ ì‹œì‘ë¨', summary: 'ê²½ìŸì‚¬ A, B, C ëŒ€ìƒ ë¶„ì„ ì§„í–‰ ì¤‘. ì„¸ë¶€ í•­ëª© ì§€ì • í•„ìš”.', icon: 'fa-magnifying-glass-chart' };
                    addAiArtifact("AIê°€ ê²½ìŸì‚¬ ë¶„ì„ ì‹œì‘í•¨ (" + new Date().toLocaleTimeString() + ")");
                } else if (currentWorkspaceType === 'investment_portfolio' && messageText.toLowerCase().includes('ë°±í…ŒìŠ¤íŒ…')) {
                    aiResponse = `ê¸€ë¡œë²Œ ESG í¬íŠ¸í´ë¦¬ì˜¤ì— ëŒ€í•œ ë°±í…ŒìŠ¤íŒ…ì„ ìš”ì²­í•˜ì…¨ìŠµë‹ˆë‹¤. ê¸°ê°„ê³¼ ì „ëµì„ ì„¤ì •í•´ì£¼ì„¸ìš”.`;
                    artifact = { title: 'ë°±í…ŒìŠ¤íŒ… ì¤€ë¹„', summary: 'ê¸°ê°„, ì „ëµ ë“± íŒŒë¼ë¯¸í„° ì„¤ì • í›„ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.', icon: 'fa-history', action: {label: 'ë°±í…ŒìŠ¤íŒ… ì„¤ì •í•˜ê¸°', func: 'alert', param: 'ë°±í…ŒìŠ¤íŒ… ì„¤ì • UI ëª©ì—…'} };
                     addAiArtifact("AI ë°±í…ŒìŠ¤íŒ… ì¤€ë¹„ ì™„ë£Œ (" + new Date().toLocaleTimeString() + ")");
                } else if (messageText.toLowerCase().includes('ìš”ì•½í•´ì¤˜') && relatedMaterialsList.children.length > 0 && relatedMaterialsList.children[0].textContent !== 'ê´€ë ¨ ìë£Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.') {
                    const firstMaterial = relatedMaterialsList.children[0].textContent;
                    aiResponse = `'${firstMaterial}' ë¬¸ì„œë¥¼ ìš”ì•½í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”... (AI ìš”ì•½ ì§„í–‰ì¤‘)`;
                     artifact = { title: `ë¬¸ì„œ ìš”ì•½: ${firstMaterial}`, summary: 'AIê°€ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ê³  í•µì‹¬ ë‚´ìš©ì„ ìš”ì•½í•©ë‹ˆë‹¤...', icon: 'fa-file-lines' };
                     addAiArtifact(`AIê°€ '${firstMaterial}' ìš”ì•½ ì‹œì‘ (${new Date().toLocaleTimeString()})`);
                }


                addChatMessage(mainWorkspaceChatArea, 'ì›Œí¬ìŠ¤í˜ì´ìŠ¤ AI', aiResponse, false, false, artifact);
            }, 1000);
        }
        
        function aiSuggestMaterial() { // Mock function for AI suggesting material
            const newMaterialName = `AI ì¶”ì²œìë£Œ_${Math.floor(Math.random() * 100)}.pdf`;
            const item = document.createElement('div');
            item.className = 'document-item';
            item.innerHTML = `<i class="fas fa-file-alt text-purple-500"></i><span>${newMaterialName} (AI ì œì•ˆ)</span>`;
            item.onclick = () => alert(`'${newMaterialName}' ì—´ê¸° (ëª©ì—…)`);
            
            if (relatedMaterialsList.firstChild && relatedMaterialsList.firstChild.textContent.includes('ìë£Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤')) {
                relatedMaterialsList.innerHTML = ''; // Clear placeholder
            }
            relatedMaterialsList.appendChild(item);
            addChatMessage(mainWorkspaceChatArea, 'ì›Œí¬ìŠ¤í˜ì´ìŠ¤ AI', `í˜„ì¬ ë…¼ì˜ì™€ ê´€ë ¨í•˜ì—¬ "${newMaterialName}" ìë£Œë¥¼ ì œì•ˆí•©ë‹ˆë‹¤. 'ê´€ë ¨ ìë£Œ' ëª©ë¡ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.`, false);
            addAiArtifact(`AIê°€ '${newMaterialName}' ìë£Œ ì œì•ˆ (${new Date().toLocaleTimeString()})`);
        }

        function addAiArtifact(logMessage) {
            const item = document.createElement('div');
            item.className = 'document-item text-xs py-1'; // Smaller text for log
            item.innerHTML = `<i class="fas fa-check-circle text-green-500"></i><span>${logMessage}</span>`;
            
             if (aiArtifactsList.firstChild && aiArtifactsList.firstChild.textContent.includes('AI ì‘ì—… ê²°ê³¼ê°€ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤')) {
                aiArtifactsList.innerHTML = ''; // Clear placeholder
            }
            aiArtifactsList.insertBefore(item, aiArtifactsList.firstChild); // Add to top
        }


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            showPersonalAssistant(); 
        });
    </script>
</body>
</html>
